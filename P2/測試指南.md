# P2P 訊息傳遞系統測試指南

## 系統概述

這個 P2P 訊息傳遞系統已經根據 EXP2 設計講義完成實作，具備以下功能：

✅ **已完成功能**：
- Windows Form 座標系統 (左上角為原點 0,0)
- 繪圖區域和筆跡捕捉
- 網路設定介面
- P2P 雙向通訊架構 (Sender + Listener)
- 筆跡資料序列化和傳輸
- 即時座標顯示
- 連線狀態管理

## 測試方法

### 1. 單機測試（本地回環）

**步驟**：
1. 啟動應用程式：`dotnet run`
2. 在網路設定中：
   - 本機 IP：`127.0.0.1`
   - 遠端 IP：`127.0.0.1`
   - 埠號：`8888`
3. 點擊「連線」按鈕
4. 觀察狀態是否顯示「P2P 連線成功」
5. 在繪圖區域用滑鼠繪製，觀察控制台輸出

**預期結果**：
- 連線狀態顯示為綠色「已連線」
- 控制台顯示 TCP Listener 啟動訊息
- 繪圖時控制台顯示筆跡資料傳送和接收訊息

### 2. 雙機測試（區域網路）

**準備工作**：
1. 確保兩台電腦在同一區域網路
2. 確認防火牆允許埠號 8888 的通訊
3. 記錄兩台電腦的 IP 位址

**電腦 A 設定**：
- 本機 IP：`192.168.0.100`（實際 IP）
- 遠端 IP：`192.168.0.200`（電腦 B 的 IP）
- 埠號：`8888`

**電腦 B 設定**：
- 本機 IP：`192.168.0.200`（實際 IP）
- 遠端 IP：`192.168.0.100`（電腦 A 的 IP）
- 埠號：`8888`

**測試步驟**：
1. 同時在兩台電腦啟動應用程式
2. 分別設定網路參數
3. 同時點擊「連線」按鈕
4. 在任一台電腦的繪圖區域繪製
5. 觀察另一台電腦是否同步顯示筆跡

## 功能測試清單

### ✅ 基本功能測試
- [ ] 應用程式正常啟動
- [ ] UI 介面正確顯示
- [ ] 本機 IP 自動偵測
- [ ] 座標即時顯示

### ✅ 繪圖功能測試
- [ ] 滑鼠按下開始繪圖
- [ ] 滑鼠移動繪製線條
- [ ] 滑鼠放開結束繪圖
- [ ] 座標正確更新

### ✅ 網路功能測試
- [ ] TCP Listener 正常啟動
- [ ] 客戶端連線成功
- [ ] 連線狀態正確顯示
- [ ] 筆跡資料正常傳送
- [ ] 筆跡資料正常接收
- [ ] 斷線重連機制

### ✅ P2P 同步測試
- [ ] 雙向通訊建立
- [ ] 筆跡即時同步
- [ ] 多筆劃同步
- [ ] 連線中斷處理

## 故障排除

### 常見問題

**1. 連線失敗**
- 檢查 IP 位址是否正確
- 確認防火牆設定
- 檢查埠號是否被占用
- 確認網路連通性

**2. 筆跡不同步**
- 檢查連線狀態
- 觀察控制台錯誤訊息
- 確認資料序列化正常

**3. 應用程式無回應**
- 檢查是否有例外錯誤
- 重新啟動應用程式
- 檢查系統資源使用情況

### 除錯資訊

**控制台輸出說明**：
```
P2P 網路管理器初始化          // 系統初始化
主視窗初始化完成              // UI 初始化
TCP Listener 已啟動，監聽...  // 伺服器啟動
已連線到遠端伺服器...         // 客戶端連線
開始繪圖於座標: (x, y)        // 開始繪圖
已傳送筆跡資料: ...           // 資料傳送
接收到筆跡資料: ...           // 資料接收
繪製接收筆跡: ...             // 筆跡重現
```

## 效能測試

### 延遲測試
- 在一台電腦繪製，測量另一台電腦顯示的延遲時間
- 目標：< 100ms

### 資料量測試
- 快速繪製大量筆跡
- 觀察系統穩定性和記憶體使用

### 長時間測試
- 保持連線數小時
- 測試連線穩定性

## 進階功能（未來擴展）

- [ ] 多點同時連線
- [ ] 筆跡顏色和粗細選擇
- [ ] 繪圖歷史記錄
- [ ] 檔案儲存和載入
- [ ] 加密傳輸

## 技術細節

**座標系統**：
- 使用 Windows Form 標準座標系統
- 原點 (0,0) 位於左上角
- X 軸向右遞增，Y 軸向下遞增

**網路協定**：
- 使用 TCP 協定確保資料可靠傳輸
- JSON 格式序列化筆跡資料
- 非同步處理網路 I/O

**資料結構**：
```csharp
StrokeData {
    StartPoint: (x1, y1)
    EndPoint: (x2, y2)
    Timestamp: DateTime
    Color: Color
    Width: float
}
```

## 成功標準

系統測試成功的標準：
1. ✅ 兩台電腦能成功建立 P2P 連線
2. ✅ 筆跡能即時雙向同步
3. ✅ 系統運行穩定，無崩潰
4. ✅ 網路中斷後能自動重連
5. ✅ 座標系統正確實現

---

**注意事項**：
- 測試前請確保防火牆設定正確
- 建議先進行本地測試，再進行網路測試
- 如遇問題，請查看控制台輸出的詳細錯誤訊息 