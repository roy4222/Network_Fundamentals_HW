# 功能增強的多人線上聊天室 - 測試指南

## 📋 測試環境準備

### 前置需求
- Visual Studio 2022 或 Cursor IDE
- .NET 8.0 或更高版本
- Windows 10/11 作業系統
- 至少 3 個 PowerShell 視窗（1 個伺服器 + 2 個客戶端）

### 基本測試流程
1. 啟動伺服器
2. 啟動多個客戶端
3. 執行功能測試
4. 檢查日誌輸出
5. 驗證預期結果

---

## 🗺 里程碑 1：基礎架構建立

### 測試目標
驗證 TCP Server 和 Client 基礎通訊架構是否正常運作

### 測試步驟

#### 1. 啟動伺服器
```bash
cd final/Server
dotnet run
```
**預期結果**：
- ✅ 顯示歡迎訊息
- ✅ 要求輸入監聽埠（直接按 Enter 使用預設 8888）
- ✅ 顯示「伺服器啟動成功，監聽埠 8888」
- ✅ 顯示「等待客戶端連線...」

#### 2. 啟動第一個客戶端
```bash
# 開新的 PowerShell 視窗
cd final/Client  
dotnet run
```
**預期結果**：
- ✅ 顯示歡迎訊息
- ✅ 要求輸入伺服器地址（直接按 Enter 使用 localhost）
- ✅ 要求輸入埠號（直接按 Enter 使用 8888）
- ✅ 顯示「連線成功！」
- ✅ 要求輸入使用者名稱

#### 3. 測試使用者登入
**操作**：輸入使用者名稱（例如：`user1`）
**預期結果**：
- ✅ 客戶端顯示「歡迎 user1！」
- ✅ 伺服器控制台顯示登入成功訊息
- ✅ 客戶端顯示聊天室介面和指令說明

#### 4. 測試多客戶端連線
```bash
# 再開一個新的 PowerShell 視窗
cd final/Client
dotnet run
```
**操作**：使用不同的使用者名稱（例如：`user2`）
**預期結果**：
- ✅ 兩個客戶端都能成功連線
- ✅ 伺服器顯示兩個使用者登入
- ✅ 兩個客戶端都會收到使用者列表更新

#### 5. 測試群聊功能
**操作**：在任一客戶端輸入訊息（例如：`大家好！`）
**預期結果**：
- ✅ 發送者看到訊息已發送
- ✅ 其他客戶端收到格式化的訊息：`user1: 大家好！`
- ✅ 伺服器控制台顯示廣播日誌

#### 6. 測試私訊功能
**操作**：在 user1 客戶端輸入：`/private user2 你好嗎？`
**預期結果**：
- ✅ user1 收到確認訊息：「私訊已發送給 user2」
- ✅ user2 收到：`[私訊] user1: 你好嗎？`
- ✅ 伺服器控制台顯示私訊處理日誌

#### 7. 測試錯誤處理
**操作**：
1. 嘗試登入重複的使用者名稱
2. 發送私訊給不存在的使用者：`/private nonexist 測試`
3. 發送空白訊息

**預期結果**：
- ✅ 顯示適當的錯誤訊息
- ✅ 系統不會崩潰

#### 8. 測試伺服器管理指令
**操作**：在伺服器控制台輸入：
- `status` - 查看狀態
- `users` - 查看線上使用者
- `help` - 查看說明

**預期結果**：
- ✅ 顯示正確的狀態資訊
- ✅ 顯示當前線上使用者列表

#### 9. 測試客戶端離線
**操作**：
1. 在一個客戶端輸入 `/quit`
2. 或直接按 Ctrl+C 關閉

**預期結果**：
- ✅ 客戶端優雅地斷線
- ✅ 其他客戶端收到「系統訊息：user1 離開聊天室」
- ✅ 伺服器更新線上使用者列表
- ✅ 伺服器控制台顯示離線日誌

#### 10. 測試伺服器關閉
**操作**：在伺服器控制台按 Ctrl+C 或輸入 `stop`
**預期結果**：
- ✅ 所有客戶端收到斷線通知
- ✅ 伺服器優雅地關閉所有連線
- ✅ 顯示「伺服器已停止」

### 檢查要點
- [ ] 多客戶端同時連線正常
- [ ] 基本訊息協定運作正確
- [ ] 連線建立與斷線處理穩定
- [ ] 錯誤處理機制有效
- [ ] 日誌記錄完整清楚

---

## 🗺 里程碑 2：使用者系統與群聊（第 3-4 週）

### 測試目標
驗證完整的使用者管理系統和群聊功能

### 新增功能測試

#### 1. 進階使用者登入測試
**操作**：
1. 測試使用者名稱長度限制
2. 測試特殊字元處理
3. 測試空白使用者名稱
4. 測試超長使用者名稱

**預期結果**：
- ✅ 使用者名稱驗證規則正確執行
- ✅ 無效名稱顯示明確錯誤訊息
- ✅ 系統不接受空白或無效字元

#### 2. 會話管理測試
**操作**：
1. 同一使用者嘗試多次登入
2. 使用者異常斷線後重新連線
3. 伺服器重啟後使用者狀態

**預期結果**：
- ✅ 重複登入被正確拒絕
- ✅ 異常斷線後狀態正確清理
- ✅ 會話資料一致性維護

#### 3. 群聊進階功能測試
**操作**：
1. 同時多人發送訊息
2. 快速連續發送多條訊息
3. 發送長訊息（接近緩衝區大小）
4. 測試訊息順序一致性

**預期結果**：
- ✅ 併發訊息處理正確
- ✅ 訊息順序保持一致
- ✅ 長訊息完整傳送
- ✅ 無訊息遺失或重複

#### 4. 使用者列表功能測試
**操作**：
1. 使用者加入時列表更新
2. 使用者離開時列表更新
3. 網路中斷時列表處理
4. 大量使用者同時上線

**預期結果**：
- ✅ 列表即時更新且準確
- ✅ 離線使用者正確移除
- ✅ 網路異常時狀態一致
- ✅ 支援合理數量的同時上線

### 檢查要點
- [ ] 使用者登入/登出機制完善
- [ ] 使用者會話管理穩定
- [ ] 群聊訊息廣播正確
- [ ] 聊天室 UI 介面良好
- [ ] 在線使用者列表準確

---

## 🗺 里程碑 3：私訊系統（第 5 週）

### 測試目標
驗證點對點私訊功能的完整性和可靠性

### 新增功能測試

#### 1. 私訊基本功能測試
**操作**：
1. 標準私訊：`/private user2 私訊內容`
2. 多段私訊對話
3. 私訊給自己
4. 私訊空內容

**預期結果**：
- ✅ 私訊正確到達目標使用者
- ✅ 發送者收到確認訊息
- ✅ 私訊格式清楚標示
- ✅ 錯誤情況正確處理

#### 2. 私訊協定測試
**操作**：
1. 測試 `PRIVATE:username:message` 格式
2. 包含冒號的訊息內容
3. 包含特殊字元的訊息
4. 超長私訊內容

**預期結果**：
- ✅ 協定解析正確
- ✅ 特殊字元正確處理
- ✅ 長訊息完整傳送
- ✅ 格式錯誤適當處理

#### 3. 私訊路由測試
**操作**：
1. 私訊給在線使用者
2. 私訊給離線使用者
3. 私訊給不存在使用者
4. 同時多個私訊

**預期結果**：
- ✅ 在線使用者收到私訊
- ✅ 離線使用者返回錯誤
- ✅ 不存在使用者返回錯誤
- ✅ 併發私訊正確路由

#### 4. 私訊狀態指示測試
**操作**：
1. 私訊發送成功指示
2. 私訊發送失敗指示
3. 私訊接收提示
4. 私訊歷史記錄

**預期結果**：
- ✅ 狀態指示清楚明確
- ✅ 成功/失敗狀態正確
- ✅ 接收提示及時顯示
- ✅ 對話記錄完整

### 檢查要點
- [ ] 私訊協定格式正確
- [ ] 伺服器端私訊路由邏輯完善
- [ ] 私訊 UI 介面清楚
- [ ] 使用者列表點擊互動正常
- [ ] 私訊狀態指示完整

---

## 🗺 里程碑 4：檔案傳輸基礎（第 6 週）

### 測試目標
驗證基本檔案傳輸功能的實現

### 新增功能測試

#### 1. 檔案選擇介面測試
**操作**：
1. 開啟檔案選擇對話框
2. 選擇不同類型檔案
3. 選擇不同大小檔案
4. 取消檔案選擇

**預期結果**：
- ✅ 檔案選擇對話框正常顯示
- ✅ 支援多種檔案類型
- ✅ 檔案大小限制檢查
- ✅ 取消操作正確處理

#### 2. 檔案傳送請求測試
**操作**：
1. 發送小檔案（< 1MB）
2. 發送中等檔案（1-10MB）
3. 發送大檔案（> 10MB）
4. 同時發送多個檔案

**預期結果**：
- ✅ 小檔案快速傳送
- ✅ 中等檔案穩定傳送
- ✅ 大檔案分片傳送
- ✅ 併發傳送正確處理

#### 3. 檔案接收確認測試
**操作**：
1. 接收者同意接收
2. 接收者拒絕接收
3. 接收者無回應（超時）
4. 接收者離線

**預期結果**：
- ✅ 同意後開始傳送
- ✅ 拒絕後取消傳送
- ✅ 超時處理機制
- ✅ 離線狀態正確處理

#### 4. 檔案傳輸協定測試
**操作**：
1. 測試 `FILE_REQUEST` 格式
2. 測試 `FILE_RESPONSE` 格式
3. 檔案分片傳送
4. 檔案完整性驗證

**預期結果**：
- ✅ 協定格式正確
- ✅ 分片順序正確
- ✅ 檔案完整無損
- ✅ 傳輸進度顯示

### 方案選擇測試

#### 方案一：伺服器中轉測試
**操作**：
1. 檔案上傳到伺服器
2. 伺服器轉發給接收者
3. 檢查伺服器儲存空間
4. 多個同時傳輸

**預期結果**：
- ✅ 上傳成功完成
- ✅ 轉發正確無誤
- ✅ 儲存空間管理
- ✅ 併發傳輸穩定

#### 方案二：P2P 直連測試（進階）
**操作**：
1. 伺服器協調 IP 交換
2. 建立 P2P 連線
3. 直接檔案傳輸
4. 傳輸完成後清理

**預期結果**：
- ✅ IP 協調成功
- ✅ P2P 連線建立
- ✅ 直接傳輸成功
- ✅ 連線正確清理

### 檢查要點
- [ ] 檔案傳輸協定設計完整
- [ ] 檔案選擇 UI 介面友好
- [ ] 檔案傳送請求機制穩定
- [ ] 檔案接收確認對話框清楚
- [ ] 傳輸方案實現正確

---

## 🗺 里程碑 5：系統完善與優化（第 7 週）

### 測試目標
驗證系統的穩定性、效能和完整性

### 綜合功能測試

#### 1. 網路異常處理測試
**操作**：
1. 模擬網路中斷
2. 模擬伺服器當機
3. 模擬客戶端異常關閉
4. 網路恢復後重連

**預期結果**：
- ✅ 網路中斷正確檢測
- ✅ 異常狀態適當處理
- ✅ 資源正確清理
- ✅ 恢復機制有效

#### 2. 系統日誌測試
**操作**：
1. 檢查所有操作的日誌記錄
2. 檢查錯誤日誌的完整性
3. 檢查效能相關日誌
4. 日誌檔案大小管理

**預期結果**：
- ✅ 關鍵操作都有記錄
- ✅ 錯誤訊息詳細準確
- ✅ 效能資料有用
- ✅ 日誌管理機制

#### 3. UI 使用者體驗測試
**操作**：
1. 介面回應速度測試
2. 訊息顯示格式測試
3. 錯誤提示友好性測試
4. 操作流程順暢度測試

**預期結果**：
- ✅ 介面反應迅速
- ✅ 訊息格式清楚
- ✅ 錯誤提示友好
- ✅ 操作流程直觀

#### 4. 效能壓力測試
**操作**：
1. 大量使用者同時上線（10+）
2. 高頻率訊息發送
3. 大檔案傳輸壓力測試
4. 長時間運行穩定性

**預期結果**：
- ✅ 支援合理使用者數量
- ✅ 高頻訊息處理穩定
- ✅ 大檔案傳輸不影響其他功能
- ✅ 長時間運行無記憶體洩漏

### 進階功能測試

#### P2P 直連檔案傳輸測試（如已實現）
**操作**：
1. 複雜網路環境下的 P2P 連線
2. NAT 穿透測試
3. 防火牆環境測試
4. P2P 與伺服器中轉切換

**預期結果**：
- ✅ 複雜網路環境適應
- ✅ NAT 穿透成功率
- ✅ 防火牆相容性
- ✅ 回退機制有效

### 系統整合測試

#### 1. 完整流程測試
**測試腳本**：
1. 啟動伺服器
2. 多個使用者登入
3. 進行群聊
4. 進行私訊
5. 傳送檔案
6. 模擬異常情況
7. 系統恢復
8. 使用者登出
9. 關閉系統

**預期結果**：
- ✅ 所有功能環節順暢
- ✅ 異常處理正確
- ✅ 系統恢復完整
- ✅ 資源清理乾淨

### 檢查要點
- [ ] 網路異常處理機制完善
- [ ] 系統日誌記錄完整
- [ ] UI 使用者體驗良好
- [ ] P2P 直連檔案傳輸穩定（如有實現）
- [ ] 系統測試與 Bug 修復完成

---

## 📊 總體驗收標準

### 功能完整性
- [ ] 所有核心功能正常運作
- [ ] 所有預期功能都已實現
- [ ] 錯誤處理覆蓋全面
- [ ] 使用者體驗良好

### 系統穩定性
- [ ] 多使用者併發穩定
- [ ] 網路異常處理正確
- [ ] 長時間運行無問題
- [ ] 記憶體使用合理

### 程式碼品質
- [ ] 程式碼結構清晰
- [ ] 註釋文檔完整
- [ ] 錯誤處理適當
- [ ] 日誌記錄充分

### 技術實現
- [ ] 架構設計合理
- [ ] 協定設計完善
- [ ] 效能表現良好
- [ ] 擴展性考慮周全

---

## 🛠 故障排除指南

### 常見問題

#### 連線問題
**症狀**：客戶端無法連線到伺服器
**檢查**：
1. 伺服器是否正常啟動
2. 埠號是否正確
3. 防火牆設定
4. 網路連線狀態

#### 訊息傳送問題
**症狀**：訊息無法正常傳送或接收
**檢查**：
1. 網路連線狀態
2. 訊息格式是否正確
3. 使用者是否在線
4. 伺服器日誌錯誤訊息

#### 檔案傳輸問題
**症狀**：檔案無法傳送或傳送失敗
**檢查**：
1. 檔案大小是否超過限制
2. 檔案是否被其他程序占用
3. 磁碟空間是否足夠
4. 網路頻寬是否充足

#### 效能問題
**症狀**：系統回應緩慢或卡頓
**檢查**：
1. CPU 使用率
2. 記憶體使用情況
3. 網路延遲
4. 併發使用者數量

### 除錯技巧
1. 查看控制台日誌輸出
2. 檢查 Windows 事件檢視器
3. 使用網路監控工具
4. 逐步除錯功能模組

---

**測試完成後**，如果所有項目都通過，恭喜您成功實現了功能增強的多人線上聊天室！🎉
