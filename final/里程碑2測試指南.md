# 里程碑 2 測試指南
**使用者系統與群聊增強功能**

## 📋 測試概述

里程碑 2 在里程碑 1 的基礎上，增強了以下功能：
- 改進的時間戳記顯示
- 更好的訊息格式化
- 系統通知功能
- 使用者加入/離開通知
- 圖形化聊天室介面

## 🎯 測試目標

驗證以下增強功能是否正常運作：
1. **時間戳記顯示** - 所有訊息都有準確的時間標記
2. **系統通知** - 使用者加入/離開時有即時通知
3. **圖形化介面** - 美觀且易用的 Windows Forms 介面
4. **私訊功能** - 點擊使用者列表進行私訊
5. **使用者列表更新** - 即時顯示線上使用者

## 🚀 測試步驟

### 前置準備

1. **編譯程式**：
   ```bash
   # 編譯伺服器
   cd final/Server
   dotnet build
   
   # 編譯客戶端
   cd ../Client
   dotnet build
   ```

2. **啟動伺服器**：
   ```bash
   cd final/Server
   dotnet run
   ```
   
   **預期結果**：
   - 顯示「[伺服器] 初始化完成，監聽埠: 8888」
   - 顯示「[伺服器] 啟動成功，監聽埠 8888」
   - 顯示「[伺服器] 等待客戶端連線...」

### 測試 1：圖形化介面啟動

1. **啟動客戶端**：
   ```bash
   cd final/Client
   dotnet run
   ```

2. **驗證 GUI 介面**：
   - ✅ 顯示「多人線上聊天室 - 里程碑 2」視窗
   - ✅ 使用者名稱輸入框有預設隨機名稱
   - ✅ 連線/斷線按鈕正常顯示
   - ✅ 聊天顯示區域、使用者列表、訊息輸入框都正確配置

### 測試 2：使用者登入與系統通知

1. **第一個使用者登入**：
   - 在使用者名稱框輸入：`測試用戶1`
   - 點擊「連線」按鈕
   
   **預期結果**：
   - ✅ 狀態變為「已連線 - 測試用戶1」
   - ✅ 聊天區域顯示：「✓ 成功連線到聊天室，歡迎 測試用戶1！」
   - ✅ 使用者列表顯示：「測試用戶1」
   - ✅ 線上人數顯示：「線上人數: 1」

2. **第二個使用者登入**：
   - 啟動第二個客戶端實例：`dotnet run`
   - 輸入使用者名稱：`測試用戶2`
   - 點擊「連線」按鈕

   **預期結果**：
   - ✅ 兩個客戶端都顯示系統通知：「[時間] 系統: 測試用戶2 已加入聊天室」
   - ✅ 使用者列表更新為：「測試用戶1, 測試用戶2」
   - ✅ 線上人數顯示：「線上人數: 2」

### 測試 3：群聊訊息與時間戳記

1. **發送群聊訊息**：
   - 在測試用戶1的訊息輸入框輸入：`大家好！這是里程碑2的測試`
   - 按 Enter 或點擊「發送」

   **預期結果**：
   - ✅ 兩個客戶端都收到格式化訊息：「[HH:mm:ss] 測試用戶1: 大家好！這是里程碑2的測試」
   - ✅ 時間戳記準確顯示當前時間

2. **雙向群聊測試**：
   - 測試用戶2 發送：`收到！時間戳記顯示正常`
   
   **預期結果**：
   - ✅ 兩個客戶端都收到：「[HH:mm:ss] 測試用戶2: 收到！時間戳記顯示正常」

### 測試 4：私訊功能

1. **使用列表點擊私訊**：
   - 在測試用戶1的使用者列表中，雙擊「測試用戶2」
   - 在彈出的私訊對話框輸入：`這是一條私訊測試`
   - 點擊確認

   **預期結果**：
   - ✅ 測試用戶2 收到：「[HH:mm:ss] 測試用戶1 (私訊): 這是一條私訊測試」
   - ✅ 測試用戶1 收到確認：「✓ 私訊已發送給 測試用戶2」
   - ✅ 私訊只有目標使用者看到，其他人看不到

2. **使用私訊按鈕**：
   - 在測試用戶2選擇使用者列表中的「測試用戶1」
   - 點擊「發送私訊」按鈕
   - 輸入：`私訊回覆測試`

   **預期結果**：
   - ✅ 測試用戶1 收到：「[HH:mm:ss] 測試用戶2 (私訊): 私訊回覆測試」

### 測試 5：使用者離開通知

1. **使用者登出**：
   - 測試用戶2 點擊「斷線」按鈕

   **預期結果**：
   - ✅ 測試用戶1 收到系統通知：「[HH:mm:ss] 系統: 測試用戶2 已離開聊天室」
   - ✅ 使用者列表更新為：「測試用戶1」
   - ✅ 線上人數顯示：「線上人數: 1」
   - ✅ 測試用戶2 視窗狀態變為「未連線」

### 測試 6：控制台模式相容性

1. **啟動控制台模式**：
   ```bash
   dotnet run --console
   ```

   **預期結果**：
   - ✅ 啟動控制台介面而非圖形化介面
   - ✅ 所有基本功能（登入、群聊、私訊）正常運作
   - ✅ 時間戳記正確顯示

### 測試 7：錯誤處理與邊界條件

1. **重複使用者名稱**：
   - 嘗試使用已存在的使用者名稱登入
   
   **預期結果**：
   - ✅ 顯示錯誤：「❌ 錯誤: 使用者名稱已存在」

2. **空白訊息**：
   - 嘗試發送空白訊息
   
   **預期結果**：
   - ✅ 訊息不會被發送

3. **私訊自己**：
   - 嘗試選擇自己進行私訊
   
   **預期結果**：
   - ✅ 顯示提示：「不能私訊自己」

## 📊 測試檢查清單

### 核心功能
- [ ] 圖形化介面正常啟動
- [ ] 使用者登入/登出功能
- [ ] 群聊訊息廣播
- [ ] 私訊功能正常
- [ ] 使用者列表即時更新

### 增強功能
- [ ] 時間戳記正確顯示
- [ ] 系統通知功能
- [ ] 使用者加入/離開通知
- [ ] 訊息格式化美觀
- [ ] UI 使用者體驗良好

### 錯誤處理
- [ ] 重複使用者名稱檢查
- [ ] 網路異常處理
- [ ] 空白輸入驗證
- [ ] 邊界條件處理

## 🎯 里程碑 2 驗收標準

**通過條件**：
1. ✅ 所有測試項目都正常運作
2. ✅ 圖形化介面美觀易用
3. ✅ 時間戳記和系統通知正確顯示
4. ✅ 多使用者可同時連線聊天
5. ✅ 私訊功能完整可用

**如果通過**：
- 可以進入 **里程碑 3：私訊系統** 的開發
- 里程碑 2 功能可作為穩定基礎

## 🔧 故障排除

### 常見問題

1. **圖形化介面無法啟動**：
   - 檢查是否安裝 .NET Desktop Runtime
   - 嘗試使用 `dotnet run --console` 啟動控制台模式

2. **連線失敗**：
   - 確認伺服器已正常啟動
   - 檢查防火牆設定
   - 確認埠 8888 未被其他程式占用

3. **訊息格式異常**：
   - 檢查伺服器控制台是否有錯誤訊息
   - 確認訊息協定版本一致

4. **私訊功能問題**：
   - 確認已選擇目標使用者
   - 檢查目標使用者是否在線上

---

**測試完成時間**: ____________________  
**測試結果**: ☐ 通過 ☐ 失敗  
**備註**: ____________________ 